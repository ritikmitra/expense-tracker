# Google Sign-In Error 400: invalid_request Troubleshooting

## Error Description
```
Error 400: invalid_request
Request details: flowName=GeneralOAuthFlow
```

## Common Causes and Solutions

### 1. Redirect URI Mismatch

**Problem**: The redirect URI in your Google Cloud Console doesn't match the one generated by your app.

**Solution**:
1. Check the console logs for the generated redirect URI
2. Add the exact URI to your Google Cloud Console OAuth 2.0 Client configuration

**Steps**:
1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Navigate to APIs & Services > Credentials
3. Edit your OAuth 2.0 Client ID
4. Add these redirect URIs:
   ```
   https://auth.expo.io/@ritikmitra/expense-tracker
   expense-tracker://auth
   ```

### 2. Client ID Configuration

**Problem**: The client ID is not properly configured for web applications.

**Solution**:
1. Ensure you're using a "Web application" OAuth 2.0 Client ID
2. Verify the client ID in `util/googleAuth.ts` matches your Google Cloud Console

### 3. API Not Enabled

**Problem**: Required Google APIs are not enabled.

**Solution**:
1. Enable these APIs in Google Cloud Console:
   - Google+ API
   - Google Identity API
   - Google OAuth2 API

### 4. Expo Go Specific Issues

**Problem**: Expo Go has specific requirements for OAuth.

**Solution**:
1. Use the correct redirect URI format for Expo Go
2. Ensure your app scheme is properly configured

## Debugging Steps

### Step 1: Check Console Logs
Look for these log messages in your terminal:
```
Redirect URI: [your-redirect-uri]
Expo Go Redirect URI: https://auth.expo.io/@ritikmitra/expense-tracker
```

### Step 2: Verify Google Cloud Console Settings
1. Client ID: `737848617497-qpkdfv3mtu75dgppuihme1k1uk856lt1.apps.googleusercontent.com`
2. Application type: Web application
3. Authorized redirect URIs should include:
   - `https://auth.expo.io/@ritikmitra/expense-tracker`
   - `expense-tracker://auth`

### Step 3: Test with Different Redirect URI
If the issue persists, try using the Expo Go redirect URI directly:

```typescript
// In util/googleAuth.ts, temporarily change:
const redirectUri = 'https://auth.expo.io/@ritikmitra/expense-tracker';
```

## Alternative Solutions

### Solution 1: Use Expo AuthSession Discovery
```typescript
const discovery = {
  authorizationEndpoint: 'https://accounts.google.com/o/oauth2/v2/auth',
  tokenEndpoint: 'https://oauth2.googleapis.com/token',
};

const request = new AuthSession.AuthRequest({
  clientId: GOOGLE_CLIENT_ID,
  scopes: ['openid', 'profile', 'email'],
  redirectUri,
  responseType: AuthSession.ResponseType.Code,
  extraParams: {
    access_type: 'offline',
  },
});
```

### Solution 2: Use Development Build
If the issue persists with Expo Go, consider using a development build:
```bash
expo run:android
# or
expo run:ios
```

### Solution 3: Check Network Connectivity
Ensure your device has proper internet connectivity and can access Google's OAuth endpoints.

## Verification Checklist

- [ ] Google Cloud Console OAuth 2.0 Client ID is configured as "Web application"
- [ ] Redirect URIs include both Expo Go and custom scheme versions
- [ ] Required Google APIs are enabled
- [ ] Client ID in code matches Google Cloud Console
- [ ] App scheme in app.json is correct
- [ ] Network connectivity is working
- [ ] No firewall blocking OAuth requests

## Still Having Issues?

1. Check the [Expo AuthSession documentation](https://docs.expo.dev/versions/latest/sdk/auth-session/)
2. Review [Google OAuth 2.0 documentation](https://developers.google.com/identity/protocols/oauth2)
3. Consider using a different OAuth library like `@react-native-google-signin/google-signin`
